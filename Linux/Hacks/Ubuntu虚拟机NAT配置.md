
## DHCP方式

方案：
- `192.168.80.1`设为网关
- `192.168.80.2`预留为宿主机IP
- `192.168.80.3-254`供分配给虚拟机

出于某些原因，VMWare不会在启动时便配置好DHCP，必须手动修改一下配置后才能正确工作。

如果仍然不能解决问题，检查顺序：
- VMWare虚拟网络管理器是否正确启用了NAT适配器，适配器的DHCP设置、NAT设置是否正确。
- 虚拟机的网络是否设置了通过DHCP获取IP。
- 宿主机的网络适配器中是否启用了NAT适配器，其IPv4配置是否正确。
- 宿主机的防火墙设置。

UPD 240419：改一下NAT适配器的网关地址，保存，再改回来，就行了（

## 静态地址

如果有SSH需求，可能需要分配静态地址。

首先宿主机需要将VMnet8适配器的DNS服务器设为网关地址。

![[Pasted image 20240428190904.png]]

以Ubuntu16.04为例，需要将IPv4连接方式设为*手动*，添加本机地址、子网掩码、网关，设置*DNS服务器地址*。

虚拟机的DNS服务器地址也直接设成网关地址。

如果配置修改之后仍不生效，建议断开虚拟机的网络连接，再重连。

假如现在能ping通网关、宿主机，但ping不通外网，建议调整宿主机的适配器设置：

![[Pasted image 20240601205133.png]]
![[Pasted image 20240601205156.png]]

如果调整了上述设置还不行，可以先检查虚拟机能否通过IP地址访问网站，如果能，则大概率是虚拟机的DNS挂了，通过修改`/etc/resolv.conf`中的`nameserver`字段为虚拟机网关，应当能够解决问题；或者关闭对应操作系统的防火墙。

## UPD 240601：一个特nc的经历

Ubuntu 22.04虚拟机，Windows 11宿主机，静态NAT联网。

虚拟机能ping通宿主机、网关，宿主机能ping通网关。宿主机有网，虚拟机不能上网，DNS失败。

虚拟机设置GUI打不开，终端正常。这也意味着只能通过命令行改网络设置，而从VMWare设置修改虚拟机连接方式不能使其自动联网。

分析发现能ping通`8.8.8.8`，但ping不通任意网址，推测是DNS挂了。首先检查`/etc/resolv.conf`，好家伙，`nameserver`是`127.0.0.53`，遂改成网关，联网成功。