
## 主要内容

- 数据链路层的功能
- 组帧
- 差错控制
	- 检错编码，纠错编码
- 流量控制与可靠传输机制
	- 流量控制、可靠传输、滑动窗口机制、停止-等待协议
	- 后退N帧协议（GBN）、选择重传协议（SR）
- 介质访问控制
	- 信道划分：频分多路复用、时分多路复用、波分多路复用、码分多路复用
	- 随机访问：ALOHA协议、CSMA协议、CSMA/CD协议、CSMA/CA协议
	- 令牌传递协议
- 局域网
	- 局域网基本概念和体系结构；以太网和IEEE 802.3
	- IEEE 802.11无线局域网；VLAN基本概念与基本原理
- 广域网
	- 广域网的基本概念
	- PPP协议
- 数据链路层设备
	- 局域网交换机及其工作原理

## 数据链路层的功能

角色：在物理层提供的服务的基础上，向网络层提供服务。

主要作用：
- 加强物理层传输比特流的功能
- 将物理层提供的可能出错的物理连接改造成逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路

功能：
- 为网络层提供服务：
	- 无确认的无连接服务：无链路连接，无确认，适用于以太网等实时连接和低误码率的网络。
	- 有确认的无连接服务：无链路连接，有确认，适用于无线通信等高误码率网络。
	- 有确认的面向连接服务：有链路连接（建立链路-传输帧-释放链路），适用于通信要求较高的场合。
- 链路管理：在面向连接的网络中，管理连接的建立、维持和释放过程。
- 帧定界、帧同步与透明传输：
	- 帧：数据链路层的传输单元，由比特流的前后添加头部和尾部构成
	- 帧定界：由帧首部和尾部中的控制信息划定帧的边界
	- 帧同步：接收方从二进制比特流中划分出帧的起始和终止点
	- 透明传输：通过有效措施，使链路上可以传输任意的比特组合
- 流量控制：
	- 背景：如果发送方发送过快，会造成帧的丢失
	- 目的：限制发送方的数据流量，使其发送速率不超过接收方的接收能力
	- 控制对象：*相邻两个结点之间的*数据链路流量
	- 反馈机制：使发送方得知接收方能否跟得上自己，什么时候可以发下一帧，什么时候必须暂停
- 差错控制：
	- 背景：由于信道噪声等原因，帧在传输过程中可能出错
	- 目的：使发送方确定接收方是否正确收到数据
	- 错误类型：
		- 位错：帧中某些位出现差错，用循环冗余校验（CRC）发现，通过自动重传请求（ARQ）方式重传出错的帧。
			- ARQ方法：每个帧传输时附带CRC码，接收方检验CRC出错则该帧被丢弃，发送方超时重传。
		- 帧错：帧的丢失、重复或失序。引入定时器和编号机制保证非重复性和顺序。

## 组帧

目的：在出错时，只重传出错的帧，而非整个比特流，提升效率。

### 字符计数法

原理：在帧的头部用一个计数字段标明帧内字符数。通过该计数字段推算帧的结束位置。

![[Pasted image 20230623085947.png]]

缺陷：如果计数字段出错，则失去帧边界划分的依据，收发双方失去同步，造成灾难性后果。

### 字符填充的首尾定界符法

原理：
- 用特定字符定界一帧的开始（SOH）和结束（EOT）。
- 为了使信息位中出现的特殊字符不被误判为首尾定界符，在这些字符前加转义字符（ESC）加以区分。

![[Pasted image 20230623090227.png]]

### 零比特填充的首尾标志法

原理：
- 使用一个特殊的比特模式“01111110”表示一帧的开始和结束
- 发送方将信息位中的每5个连续1的后面追加一个0
- 接收方识别01111110序列作为开始和结束控制序列，自动拿掉每5个连续1后面的0

特点：性能优于字符填充法，易于用硬件实现。

![[Pasted image 20230623095531.png]]

### 违规编码法

原理：利用物理层编码阶段中的违规编码（如曼彻斯特编码的1-1编码，与表示1的1-0编码和表示0的0-1编码相对）实现控制功能。

特点：
- 不需要任何填充技术
- 但也只适用于采用冗余编码的特殊编码环境

## 差错控制

背景：实际通信链路都是不理想的，任何比特在传输过程中均可能出错。

比特差错：外界或链路因素导致比特与预期值反转，1变成0，0变成1。

分类：
- 自动重传请求（ARQ）：检错
- 前向纠错（FEC）：纠错

### 检错编码

核心思想：
- 在有效数据发送前，根据某种关系附加一定的冗余位，构成一个符合某一规则的码字再发送。
- 一旦出现比特差错，它将破坏先前计算冗余位时使用的规则，便于接收端发现并通知重传。

#### 奇偶校验码

组成：
- 信息元：$n-1$位，包含信息。
- 校验元：一位，使整个校验码中1的个数为奇数（奇校验码）或偶数（偶校验码）。

原理：接收方对奇偶校验码计算异或和，检查是否为1（奇校验码）或0（偶校验码）。

特点：
- 只能检测奇数位的出错情况
- 无法定位出错位

#### 循环冗余码（CRC，多项式码）

**本知识点是重点。**

背景：任何一个$k$位二进制都可与一个以$0,1$为系数的$k-1$次多项式一一对应。

原理：
- 收发双方约定一个$0,1$系数的多项式$G(x)$。
- 发送方对每个$m$比特的帧或报文，根据$G(x)$生成一个$r$比特的帧检验序列（FCS），整个帧的最终长度是$m+r$比特。
- 接收方根据$G(x)$对整个帧进行检验。

步骤：设待发送的帧为$M(x)$，约定的多项式$G(x)$。
- 加0：若$G(x)=O(x^{r-1})$，则令$M'(x)=x^{r-1}M(x)$。
- 模2除：令$M'(x)$为被除数，$G(x)$为除数，利用模2除法计算出余数多项式$R(x)$，该多项式对应的$r$位二进制序列作为FCS。

举例：$M(x)=101001$，$G(x)=1101$。
- $G(x)$为3阶，$R_6(x)=M'(x)=101001000$作为被除数。
- 首位为1：$R_5(x)=R_6(x)\oplus x^6G(x)=11101000$。
- 首位为1：$R_4(x)=R_5(x)\oplus x^5G(x)=0111000$。
- 首位为0：$R_3(x)=R_4(x)=111000$。
- 首位为1：$R_2(x)=R_3(x)\oplus x^3G(x)=01100$。
- 首位为0：$R_1(x)=R_2(x)=1100$。
- 首位为1：$R_0(x)=R_1(x)\oplus xG(x)=001$，作为余数。
- 将余数$001$追加到$M(x)$后：$P(x)=r^3M(x)+R_0(x)=101001001$即为待发送序列。

![[Pasted image 20230623104317.png]]

### 纠错编码（海明码）

**本知识点是重点。计组部分的海明码删除，但这里仍然要考。**

纠错原理：冗余信息足够，使接收方能够推算出信息元中的哪一位出了错。

**注意：纠错编码并不特指海明码，而是以海明码为代表。**

海明码背景知识：
- 码字的海明距离（码距）：两个合法编码的对应比特取值不同的比特数。
- 编码集的海明距离（码距）：编码集中任意两个合法编码的海明距离的最小值。
- 码距与纠错能力的关系：
	- 码距为1：无法检测错误。
	- 码距为2：可以检测一位错，但无法纠错。
	- 码距为$k$：可以检测$k-1$位错，纠正$\dfrac{k-1}{2}$位错。

海明码核心思想：
- 在有效信息位中加入几个校验位形成海明码，把每个二进制位分配到几个奇偶校验组。
- 当某一位出错后，就会引起数个校验位数值的变化，这些位的变化可以指出错位的具体位置。

海明码编码过程：
- 确定海明码的位数
- 确定校验位的分布
- 分组以形成校验关系
- 校验位取值

**确定海明码的位数**：
设$n$为有效信息的位数，$k$为校验位的位数，对于只检测一位错的海明码，则$n$和$k$满足：
$$
n+k\le 2^k-1
$$
对于检测两位错的海明码，需要一位额外的校验码，对应地有：$n+k+1\le 2^k-1$。

这些要求的

例如：$n=4$，需要检测一位错，则校验位的最低位数$k=3$。如果需要检测两位错，则3位校验码不能符合要求，相应地需要$k=4$。

**确定校验码的分布**：
以$n=4$和$k=3$的7位海明码为例，各位从后往前排列和定义如下：

| 位置 | $H_7$ | $H_6$ | $H_5$ | $H_4$ | $H_3$ | $H_2$ | $H_1$ |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 内容 | $D_4$ | $D_3$ | $D_2$ | $P_3$ | $D_1$ | $P_2$ | $P_1$ |
| 功能 | 信息位 | 信息位 | 信息位 | 校验位 | 信息位 | 校验位 | 校验位 |

统一规定：
- $P_i(i=1,2,\cdots,k)$为校验位，分布在从前开始数第$1,2,\cdots,2^{k-1}$位上。
- $D_i(i=1,2,\cdots,n)$为数据位，依次分布在未被校验位占据的各个位置。
- 如果选用检测两位错的海明码，则$P_{k+1}$追加到整个序列的末尾。

**分组以形成校验关系**：
每个数据位用多个校验位进行校验，但满足条件：被校验数据位的海明位号（$H_i$）等于校验该数据位的各校验位海明位号之和。

以$n=4$和$k=3$的7位海明码为例：数据位$D_4$在$H_7$的位置上，由$H_1,H_2,H_4$对应的校验位$P_1,P_2,P_3$共同校验。对应地有：
- $D_1\rightarrow P_1,P_2$。
- $D_2\rightarrow P_1,P_3$。
- $D_3\rightarrow P_2,P_3$。
- $D_4\rightarrow P_1,P_2,P_3$。

分组：列出每个校验位校验的所有数据位，$P_i$校验的所有数据位为第$i$组。
- 第1组：$D_1,D_2,D_4$。
- 第2组：$D_1,D_3,D_4$。
- 第3组：$D_2,D_3,D_4$。

**校验位取值**：
$P_i$的值为第$i$组的所有数据位取异或的结果。

对数据值$1010$计算校验码（通常而言，取后面为前）：
- $P_1=D_1\oplus D_2\oplus D_4=0\oplus 1\oplus 1=0$。
- $P_2=D_1\oplus D_3\oplus D_4=0\oplus 0\oplus 1=1$。
- $P_3=D_2\oplus D_3\oplus D_4=1\oplus 0\oplus 1=0$。

因此，$D_4D_3D_2D_1=1010$对应的海明码为$\overline{H_7H_6H_5H_4H_3H_2H_1}=1010010$。

**海明码的校验原理**：
接收方收到海明码后，对每个校验组分别利用校验位和参与形成该校验位的信息位进行奇偶校验检查，构成$k$个校验方程：
- $S_1=P_1\oplus D_1\oplus D_2\oplus D_4$。
- $S_2=P_2\oplus D_1\oplus D_3\oplus D_4$。
- $S_3=P_3\oplus D_2\oplus D_3\oplus D_4$。

检查$S_3S_2S_1$的数值：若为零则海明码无误，否则为出错位的编号：若$S_3S_2S_1=4$，则说明$H_4$出现了比特错，需要反转过来。

## 流量控制和可靠传输机制

### 流量控制、可靠传输、滑动窗口机制

流量控制的基本方法：
- 停止-等待协议
- 滑动窗口协议

**停止-等待流量控制基本原理**：
- 发送方每发一帧，都需要等待接收方应答，之后才能发下一帧。
- 接收方每收一帧，都需要反馈一个应答信号，表示可以接收下一帧。
	- 如果无应答，则发送方必须一直等待。
- 每次只允许发送一帧，然后陷入等待接收方确认信息的过程中，传输效率很低。

**滑动窗口流量控制基本原理**：

收发双方各维持一个窗口：
- **发送窗口**：发送方维持一组连续的允许发送的帧序号。
	- 功能：对发送方进行流量控制。
	- 窗口大小（$W_T$）：在未被对方确认时，最多能继续发多少帧。
- **接收窗口**：接收方维持一组连续的允许接收帧的序号。
	- 功能：控制接收方接收和拒绝哪些帧。
	- 窗口大小（$W_R$）：当前哪些帧仍没收到，且可被接收。

发送窗口滑动：
![[Pasted image 20230623154209.png]]

接收窗口滑动：
![[Pasted image 20230623154218.png]]

窗口操作：
- 发送端每收到一个确认帧，发送窗口就向前滑动一个帧的位置。
- 发送端总是尝试发送窗口内所有可发送的帧。
- 接收端收到数据帧后，如果该帧在窗口内，则将接收窗口前移一个位置；如果该帧落在窗口外，则将该帧丢弃掉。

滑动窗口的重要特性：
- 只有接收窗口向前滑动（同时向发送端发ACK）时，发送窗口才可能向前滑动。
- 后面的停-等协议、后退N帧协议和选择重传协议只在发送窗口大小上有差别。
	- 停-等协议：$W_T=1,W_R=1$。
	- 后退N帧协议：$W_T>1,W_R=1$。
	- 选择重传协议：$W_T>1,W_R>1$。
- 接收窗口的大小为1时，能保证帧的有序接收。
- 数据链路层的滑动窗口协议中，窗口大小在传输全程是恒定的，这一点与传输层的滑动窗口协议不同。

**可靠传输机制**：
- 确认：可以是一个无数据的控制帧，也可以被回复帧捎带（捎带确认）。
- 超时重传：发送数据帧后一定时间内未得到ACK，则重新发送。

自动重传机制（ARQ）：接收方主动请求发送方重传出错数据帧的机制。
- 传统ARQ：停止-等待ARQ、后退N帧ARQ、选择重传ARQ。
- 连续ARQ

### 单帧滑动窗口和停止-等待协议

停止-等待协议相当于$W_T=W_R=1$的滑动窗口协议。

可能的差错：
- 数据帧丢失：发送方超时重传。
- 到达目的站的帧遭到破坏：接收方丢弃，发送方超时重传。
- 数据帧正确而确认帧遭到破坏：发送方超时重传，接收方丢弃并重传ACK。

特点：
- 数据帧用0、1编号，对应确认帧用ACK0、ACK1表示
- 收发双方各有一个帧缓冲区：发送方存储数据帧副本便于重传，接收方存储前一帧的副本便于判重。
- 通信信道利用率过低。

![[Pasted image 20230623154237.png]]

### 多帧滑动窗口和后退N帧协议（GBN）

原理：
- 滑动窗口：若帧编号为$n$比特，则满足$1\le W_T\le 2^n-1,W_R=1$。
	- 若$W_T>2^n-1$，则接收方可能无法辨别新旧帧
- 非阻塞：发送方无需收到上一帧的ACK就可发送下一帧
- 接收方只允许**按序接收**：
	- 接收方检测到失序帧，则要求发送方重传最后一个正序帧后的所有未被确认的帧
	- 发送方发现某一帧超时，则必须重传该帧及其后的所有帧
- **累积确认**：接收端不必对每个帧单独确认，而是可以通过确认最后一个正确收到的数据帧连带确认之前的所有数据帧。

特点：
- 连续发送数据帧可以提高信道利用率
- 但重传时连带重传正确发送的数据帧，又降低了传输效率

以下图为例，选取两个事件解释：
- 2号帧出错，发送方发现超时，于是重传2-8号帧，先前发送的3-7号帧由于2号帧未确认而被悉数丢弃。
- 在2号帧出错后，接收方长时间不发ACK2，直到重传2号帧被收到时才收到ACK2。
![[Pasted image 20230623163052.png]]

### 多帧滑动窗口和选择重传协议（SR）

原理：
- 滑动窗口：$1\le W_T\le 2^{n-1},1\le W_R\le 2^{n-1}$。
	- 如果大于上限，则收发双方无法确认重传的帧是新帧还是旧帧。
- 每个发送缓冲区对应一个计时器，超时则会重传该帧。
- ACK帧：接收方会对每个成功接收的帧回复ACK给发送方。
- NAK帧：如果接收方怀疑帧$t$出错，则会发送NAKt给发送方，要求发送方重传。
- **选择重传**：一旦出错，只会重传出错的帧，不会重传其他帧。

特点：
- 可以避免重复传送那些正确到达的数据帧
- 但接收端需要设置相当容量的缓冲区来暂存未按序收到的帧

![[Pasted image 20230623172858.png]]

### 信道效率和信道吞吐率

**信道效率**（信道利用率）：对发送方而言，在一个发送周期内有效发送数据所需时间占整个发送周期的比率。
- **发送周期**：发送方从开始发送数据到收到该数据的ACK帧经历的时间。
- 计算：设发送周期$T$，传输量$L$，传输速率$C$，则信道效率$\eta=(L/C)/T$。

**信道吞吐率**：信道利用率和发送方发送速率的乘积。

## 介质访问控制（MAC）

- 主要任务：为使用介质的每一个结点隔离来自同一信道上其他结点所传送的信号。
- **介质访问控制子层**：决定广播信道中信道分配的协议子层。

### 信道划分介质访问控制

功能：将使用介质的每个设备与来自同一通信信道上其他设备的通信隔离开，把时域和频域资源合理分配给网络上的设备。

**多路复用技术**：
- 背景：传输介质的带宽超过单个信号的带宽，介质只传输一路信号浪费资源。
- 思路：一条介质上携带多个传输信号，提高传输系统的利用率。
- 实质：通过分时、分频、分码等方法把原来的一条广播信道，逻辑上分为几条用于两个结点之间通信的互不干扰的子信道，实际上是把广播信道转化为点对点信道。
- 分类：频分多路复用、时分多路复用、波分多路复用、码分多路复用。

#### 频分多路复用（FDM）

原理：将多路基带信号调制到不同频率载波上，再叠加形成一个复合信号的多路复用技术。

特点：
- 每个子信道的带宽可不相同，但总和不能超过信道总带宽
- 相邻子信道之间需要保护带
- 充分利用了传输介质的带宽，系统效率较高；技术成熟，实现较容易

![[Pasted image 20230623191925.png]]

#### 时分多路复用（TDM）

原理：将一条物理信道按时间划分为若干时间片，轮流分配给多个信号使用，每个时间片都由复用的一个信号占用。

特点：
- 时效性：就某时刻而言，TDM信道上传送的仅是某一对设备间的信号；就某段时间而言，传送的是按时间分割的多路复用信号。
- **统计时分多路复用**（STDM）：TDM的一种改进，并不固定分配时隙，而是动态按需分配，当终端有数据要传送时，才会分配到时间片。

![[Pasted image 20230623191936.png]]

#### 波分多路复用（WDM）

特指光的频分多路复用。

原理：在一根光纤上传输多种不同波长（频率）的光信号。由于波长不同，各路光信号不互相干扰，最后用波长分解复用器将各路波长分解出来。



#### 码分多路复用（CDM）

原理：采用不同编码区分各路原始信号。与FDM和TDM相比，它既共享频率，又共享时间。

**码分多址**（CDMA）

特点：
- 时间划分：每个比特时间划分为$m$个短的时间槽，称为**码片**。现实生活通常$m=64$或$m=128$，做题时$m$往往较小。
- 站点码片序列：每个站点拥有唯一的$m$位码片序列，各站点的码片序列相互正交。
- 站点发送序列：站点发1时，发送它的码片序列；发0时，发送它码片序列的反码。
- 信道特征：各站点发送的序列在信道内线性相加。

原理：
在CDMA码片中，比特1记作$+1$，比特0记作$-1$。码片序列为00011011的站点码片记作$(-1,-1,-1,+1,+1,-1,+1,+1)$。

任意两个站点的码片序列$S,T$正交：它们的内积为零。
$$
S\cdot T=0
$$
站点码片的规格化内积为1：
$$
S\cdot S=\dfrac{1}{8}\sum_{i=1}^8 S_i^2=\dfrac{1}{8}\cdot 8=1
$$
设$S=(-1,-1,-1,+1,+1,-1,+1,+1)$和$T=(-1,-1,+1,-1,+1,+1,+1,-1)$，若$S$所在的站点发送比特1，同时$T$所在站点发送比特0，则公共链路上的码元：
$$
X=S+T=(0,0,-2,2,0,-2,0,-2)
$$

若第三个站点想获取$S$所在站点的信息，则它应当将链路上的码元与$S$作规格化内积：$X\cdot S=(S+T)\cdot S$，该内积的值的意义：
- 1：$S$所在的站点发送了比特1
- -1：$S$所在的站点发送了比特0
- 0：$S$所在的站点当前静默

### 随机访问介质访问控制

