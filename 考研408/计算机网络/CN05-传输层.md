
## 要点

- 传输层提供的服务：
	- 传输层的功能
	- 传输层寻址与端口
	- 无连接服务和面向连接服务
- UDP：UDP数据报、UDP校验
- TCP
	- TCP段
	- TCP连接管理
	- TCP可靠传输
	- TCP流量控制与拥塞控制

## 传输层提供的服务

### 传输层的功能

定位：面向通信部分的最高层，用户功能的最低层。

**传输层的功能**：
- 提供两个应用进程之间的逻辑通信（端到端的通信）。
- 复用和分用：
	- 复用：发送方不同的应用进程可使用同一个传输层协议传送数据。
	- 分用：接收方的传输层在剥去报文的首部后，能够将这些数据正确交付到目的应用进程。
- 差错检测：对收到的报文进行差错检测（首部和数据部分）。
	- 相比之下，网络层只检测首部。
- 提供两种不同的传输协议：TCP、UDP。

作用：向高层用户屏蔽了低层网络的核心细节，仅在传输层协议不同时体现出差别。
- TCP：全双工信道。
- UDP：不可靠信道。

### 传输层的寻址和端口

**端口（Port）的作用**：
- 作用：让应用进程将其数据通过端口向下交付给传输层，让传输层知道应当将其报文段中的数据向上通过端口交付给应用层相应的进程。
- 服务访问点（SAP）：
	- 传输层：端口。
	- 网络层：IP地址。
	- 数据链路层：MAC地址。

**端口号**：
- 作用：标识一个唯一的端口，长16bit，有65536个。
- 意义：只用于区分本计算机下的不同应用进程。
- 分类：
	- 服务器端端口号：
		- 熟知端口号：0-1023。
		- 登记端口号：1024-49151。
	- 客户端端口号：49152-65535。

**套接字**（Socket）：IP地址加端口号，在网络中识别各个端点。

### 无连接服务和面向连接服务

**传输控制协议**（Transmission Control Protocol，TCP）：
- 提供**面向连接服务**：通信双方通信前必须建立连接，通信过程中实时监控和管理连接，通信结束后释放连接。
- 不提供广播或组播服务。
- 适用情形：可靠性更重要的场合：FTP、HTTP、TELNET等。

**用户数据报协议**（User Datagram Protocol，UDP）：
- 只提供两个附加服务：多路复用、错误检查。
- 适用情形：实时性和速度更重要的场合：DNS、TFTP、SNMP、RTP等。

## UDP协议

### UDP数据报

**UDP优点**：
- 无需建立连接，不会引入连接时延。
- 无连接状态。
- 分组首部开销小。
- 应用层能更好地控制要发送的数据和发送时间。
- 支持一对一、一对多、多对一和多对多交互通信。

**UDP特点**：
- 常用于一次性传输数据较少的网络应用，如DNS、SNMP等。
- 不保证可靠交付，可靠性维护在应用层。
- 面向报文。

**UDP数据报结构**：
- 首部：8字节64位。
	- 源端口号：16位。需要对方回信时用。
	- 目的端口号：16位。必填。
	- UDP长度：16位。最小值是8，最大值是64K-1。
	- UDP校验和：16位。
- 数据：可有可无。

![[Pasted image 20230708102110.png]]

### UDP校验

UDP校验机制：校验前在数据报前临时添加一个伪首部，计算该临时数据报（而非原始数据报）的校验和。

**UDP伪首部**：12B的内容。
- 源IP地址：4B。
- 目的IP地址：4B。
- 全0填充：1B。
- 17：1B。
- UDP长度：2B。

**UDP校验流程**：
- 发送方先将全零放入校验和字段，添加伪首部，如果临时数据报为奇数个字节，则在末尾补一个空字节。
- 按二进制反码，从数据报头部开始计算各个16bit的数据和，将此和二进制反码写入校验和字段，并发送（不发送伪首部部分）。
- 接收方把收到的UDP数据报加上伪首部，补齐为偶数个字节，按二进制反码求各16bit的和。计算结果全1则无差错，否则有差错。

![[Pasted image 20230708110716.png]]

![[Pasted image 20230708110738.png]]

**UDP校验的特点**：

## TCP协议