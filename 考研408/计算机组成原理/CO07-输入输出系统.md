
## 框架

- I/O系统基本概念（略）
- I/O接口
	- 功能：地址译码和设备选择、主机和外设的通信联络控制、数据缓冲、信号格式转换、传送控制命令和状态信息
	- 基本结构
	- 类型：并行/串行、程序查询/中断/DMA、可编程/不可编程
	- 端口及其编址：统一编址、独立编址
- I/O方式
	- 程序查询方式
	- 程序中断方式
	- DMA方式

## 程序查询方式

**工作流程**：
- 初始化：CPU预置传送参数、向I/O端口发送命令字、启动I/O设备。
- 等外设：从外设接口读状态信息、CPU不断查询I/O设备状态直到外设就绪。
- 传数据：传送一次数据、修改地址和计数器参数。
- 循环：如传送未结束则循环等外设、传数据两个操作。

## 程序中断方式

### 工作流程

**中断请求**

**中断响应判优**：
- 不可屏蔽中断：最高优先级
- 内部异常
	- 硬件故障
	- 软件中断
- 可屏蔽中断：最低优先级
	- DMA中断请求
	- I/O传送类请求：高速设备>低速设备、输入设备>输出设备、实时设备>普通设备

**CPU响应中断的条件**：
- 中断源有中断请求
- CPU允许中断及开中断（异常和NMI中断除外）
- 一条指令执行完毕（异常不受此限制），且无更紧迫的任务

**中断响应过程**：
- 关中断
- 保存断点
- 引出中断服务程序

**中断处理过程**：
- 中断响应：关中断、保存断点、引出中断服务程序
- 保存现场和屏蔽字
- 开中断
- 执行中断服务程序
- 关中断
- 恢复现场和屏蔽字
- 开中断、中断返回

### 多重中断和中断屏蔽技术

WIP

## DMA方式

**特点**：
- 使主存和CPU的固定联系脱钩
- 传送时主存地址的确定、传送数据的计数等都由硬件电路直接实现
- 主存中要开辟专用缓冲区，及时供给和接收外设的数据
- 传送速度快，提高系统效率
- 有预处理和后处理机制

### DMA控制器

**主要功能**：
- 接受外设发出的DMA请求，并向CPU发出总线请求
- 在CPU响应后接管总线控制权，进入DMA操作周期
- 确定传送数据的主存单元和长度，自动修改主存地址和传送长度计数
- 规定传送方向，发控制信号，执行读写操作
- 向CPU报告读写操作结束

### 传送方式

- 停止CPU访存：DMA向CPU发送停止信号，CPU脱离总线，DMA传送一块后将总线控制权交还CPU。
- 周期挪用：
	- CPU不在访存：无冲突。
	- CPU正在访存：必须等待存取周期结束，再取得总线占有权。
	- CPU和DMA同时请求访存：CPU暂时放弃总线占有权。
- DMA与CPU交替访存：如果CPU周期大于主存存取周期，则可将CPU周期划分出一部分专用于DMA访存。

### 传送过程

- 预处理
- 数据传送
- 后处理

![[Pasted image 20230930231859.png]]

### DMA与中断方式的区别

- DMA不中断任何程序，不保护现场，除预处理和后处理外不占用CPU资源。
- 对DMA请求的响应可以发生在任一机器周期结束时。
- DMA传送过程不需要CPU的干预。
- DMA请求的优先级更高。
- DMA方式不具备处理异常的能力，仅局限于大批数据的传送。
- DMA方式靠硬件而非程序传送数据。

## 选择题整理-非真题

### 7.2-I/O接口

![[Pasted image 20230930212118.png]]

1题选A。统一编址没有专门的I/O指令，因此不能通过系统总线区分存储单元和I/O设备，而只能通过不同的地址区分。

![[Pasted image 20230930212130.png]]

7题选B。磁盘驱动器的写入机制是在同一磁道、同一柱面上逐个扇区写入，因此是并行方式写入。

8题选A。在系统调用层使用的地址是逻辑地址，到主存或外设层面才会使用物理地址。

### 7.3-I/O方式

![[Pasted image 20230930233039.png]]
![[Pasted image 20230930233054.png]]

4题选C。第三个说法反了。

![[Pasted image 20230930233109.png]]

5题选。

6题选。

7题选。

![[Pasted image 20230930233121.png]]

![[Pasted image 20230930233129.png]]

![[Pasted image 20230930233141.png]]

![[Pasted image 20230930233152.png]]

![[Pasted image 20230930233203.png]]

![[Pasted image 20230930233242.png]]

![[Pasted image 20230930233250.png]]

![[Pasted image 20230930233419.png]]

## 选择题整理-真题

![[Pasted image 20230930212755.png]]

9题选D。数据缓冲寄存器、命令/状态寄存器的内容均通过数据线传递，地址线传递数据交换的端口地址，控制线传输读写控制信号。

![[Pasted image 20230930212803.png]]

12题选A。磁盘驱动器是磁盘本身，并不是I/O接口。

![[Pasted image 20230930233434.png]]

![[Pasted image 20230930233447.png]]
![[Pasted image 20230930233458.png]]

![[Pasted image 20230930233512.png]]
![[Pasted image 20230930233525.png]]

## 大题整理