
## 框架

- 网络应用模型
	- 客户/服务器模型
	- P2P模型
- 域名系统（DNS）
	- 层次域名空间：顶级域、二级域、三级域
	- 域名服务器
	- 域名解析过程
- 文件传输协议（FTP）
	- 工作原理
	- 控制连接、数据连接
- 电子邮件
	- 电子邮件系统的组成结构
	- 电子邮件格式与MIME
	- SMTP、POP3
- 万维网（WWW）
	- 概念与组成结构
	- HTTP

## DNS

**顶级域分类**：国家顶级域、通用顶级域、基础结构域。

### 域名服务器

**层次服务器**：
- 根域名服务器：最重要的域名服务器，全球13组，一般只间接解析。
- 顶级域名服务器：管理一个顶级域下的所有二级域名，可能直接解析，也可能间接解析。
- 授权域名服务器：将其管辖的主机名转换为该主机的IP地址。
- 本地域名服务器：直接负责其他主机的DNS请求。

### 域名解析过程

**域名解析分类**：正向解析（域名到IP）、反向解析（IP到域名）。

**递归查询**：主机->本地->根->顶级->权限，原路返回。

**迭代查询**：
- 主机先查本地域名服务器。
- 本地域名服务器进行迭代查询：
	- 先查根域名服务器，根域名服务器返回顶级域名服务器IP。
	- 查顶级域名服务器，返回授权域名服务器的IP。
	- 查授权域名服务器，返回待查域名的IP。
- 本地域名服务器返回待查域名的IP给主机。

**DNS缓存机制**

## FTP

**功能**：主机间文件传输、用户文件管理、公用文件共享。

**服务器组成**：
- 主进程：接收新的请求
- 若干从属进程：处理单个请求

**控制连接**：21号端口，传输7位ASCII控制信息

**数据连接**：20号端口。
- 主动模式PORT：客户端提供端口，服务端通过端口发数据
- 被动模式PASV：服务端开放端口，客户端向这个端口传数据

## 电子邮件

**系统组成结构**：
- 用户代理：邮件客户端程序。
- 邮件服务器：收发邮件，向发信人报告邮件的传送情况。
- 邮件发送协议和读取协议

**收发过程**：
- 用户写信，用户代理用SMTP把邮件发给发送端邮件服务器
- 发送端邮件服务器将邮件缓存
- 发送端邮件服务器的SMTP客户进程发现缓存邮件，向接收端邮件服务器的SMTP服务器进程发起TCP连接
- SMTP客户向SMTP服务器发送邮件，释放TCP连接
- 接收端邮件服务器的SMTP服务器进程将邮件放入收信人的用户邮箱（POP3）
- 收信人的用户代理从服务器拉取信件

### 电子邮件格式

```
From:christopherray@fbi.gov
To:ghxx040406@163.com
Subject:FBI WARNING

Federal Law provides severe civil and criminal penalties for the unauthorized reproduction, distribution or exhibition of copyrighted motion pictures (title 17,united states code,sections 501 and 508),the federal bureau of investigation investigates allegations of criminal copyright infringement (title 17,united states code,section 506)
```

### SMTP、POP3

**SMTP通信**：
- 连接建立
- 邮件传送
- 连接释放

**POP3工作方式**：下载并保留、下载并删除。

## 万维网（WWW）

**WWW的三个标准**：URL、HTTP、HTML

### HTTP操作过程

**用户通过浏览器访问一个网站的全过程**：
1. **用户输入URL**（统一资源定位符）： 用户首先在Web浏览器的地址栏中输入他们想要访问的网页的URL。URL是一个标识网页位置的字符串，它包括协议（通常是HTTP或HTTPS），域名（如www.example.com），以及资源的路径。
2. **DNS解析**： 浏览器接收到URL后，需要将域名解析为IP地址。这是通过DNS（域名系统）完成的，浏览器向本地DNS缓存或互联网服务提供商的DNS服务器发送查询，以获取域名对应的IP地址。一旦找到IP地址，浏览器就能够向该地址发送请求。
3. **建立TCP连接**： 一旦浏览器获得了目标服务器的IP地址，它将尝试建立到该服务器的TCP连接。这是一个三次握手的过程，用于确保客户端和服务器之间的通信可靠。
4. **发起HTTP请求**： 一旦TCP连接建立，浏览器将发送一个HTTP请求到目标服务器。HTTP请求包含请求的方法（GET、POST等），以及资源的路径和其他头部信息（例如，用户代理信息）。
5. **服务器处理请求**： 服务器接收到HTTP请求后，会根据请求的内容和头部信息来处理它。这可能涉及到访问数据库、生成动态内容、或者从服务器的文件系统中获取静态文件。
6. **服务器发送HTTP响应**： 服务器处理完请求后，会生成一个HTTP响应，其中包含了请求的资源以及相关的元数据。响应的状态码指示请求是否成功，如果成功，响应通常包括状态码200 OK。
7. **数据传输**： 一旦服务器生成HTTP响应，它将使用TCP连接将响应数据传输回浏览器。数据可能分为多个数据包，这些数据包通过互联网传输，直到它们到达浏览器所在的计算机。
8. **浏览器渲染页面**： 浏览器接收到响应数据后，将其解析并渲染成用户可视的网页。这可能涉及HTML、CSS和JavaScript的处理，以及资源如图像、样式表和脚本的下载和加载。
9. **前端交互**： 如果网页包含与用户的交互元素，例如表单或按钮，用户可以与页面进行交互。浏览器将捕获用户的输入，并可能生成新的HTTP请求以响应用户的操作。
10. **终止TCP连接**： 当网页加载完毕或用户关闭浏览器标签时，浏览器将关闭与服务器的TCP连接，释放网络资源。

### HTTP报文

**类别**：请求报文、响应报文。

**方法**：GET、POST、HEAD、CONNECT、PUT、DELETE。

**组成**：
- 开始行
- 首部行
- 实体主体

## 选择题整理-非真题

### 6.1-网络应用模型

![[Pasted image 20231006000116.png]]

5题选D。说法反了，客户机是面向用户的，服务器是面向任务的。

### 6.2-DNS

![[Pasted image 20231006000149.png]]

1题选D。IP和域名没有一一对应关系，多个域名可以对应一个IP，一个域名也可对应多台主机（及其MAC地址）。

### 6.3-FTP

![[Pasted image 20231006001954.png]]

6题选B。文件列表在FTP中通过数据连接传输，所以走20号端口。

7题选D。在FTP的数据连接中，客户端一般是用自定义的端口连接服务器的20号端口。

8题选B。

### 6.4-电子邮件

![[Pasted image 20231006002303.png]]

2题选A。SMTP、POP3都是基于TCP协议。

![[Pasted image 20231006002314.png]]

3题选A。邮件服务器和用户端收发邮件一般用HTTP协议，在邮件服务器之间传递邮件使用SMTP协议。

![[Pasted image 20231006002628.png]]

5题选C。SMTP一般用于邮件服务器之间传递邮件，而非用户从邮件服务器接收邮件。

![[Pasted image 20231006002637.png]]

7题选B。POP3在传输层使用明文传输密码。

## 选择题整理-真题

![[Pasted image 20231006000325.png]]

9题选A。递归查询方法中，用户主机发送一次DNS请求到本地域名服务器，本地域名服务器发送一次DNS请求到根域名服务器。

10题选C。如果域名服务器有该域名的DNS结果，则无需任何查询，即0次DNS查询；如果没有，则最坏的情况包括4次DNS请求：
- 查根域名服务器，得顶级域名服务器（.com）的IP。
- 查顶级域名服务器（.com），得权限域名服务器（.xyz.com）的IP。
- 查权限域名服务器（.xyz.com），得权限域名服务器（.abc.xyz.com）的IP。
- 查权限域名服务器（.abc.xyz.com），得域名（www.abc.xyz.com）的IP。

![[Pasted image 20231006001434.png]]

11题选C。客户端与FTP服务端的连接一般使用自定义端口。

![[Pasted image 20231006002656.png]]

9题选A。SMTP不支持用户和邮件服务器直接交换信件。

10题选D。POP3基于TCP，所以是有连接的可靠数据传输服务。

![[Pasted image 20231007192800.png]]

13题选B。注意这道题当时犯了**两个错误（没有模拟拥塞控制过程、没有进行握手连接）**，导致选的答案恰恰是对的。

首先是H向S发起TCP连接请求，进行三次握手，耗费一个RTT。

随后是H向S请求`/news408.html`，S发回一个报文。再后是H向S请求页内图像，S分3个报文发回这幅图像。从拥塞控制角度，第一个报文在首个RTT内发送和接收完毕，随后拥塞窗口增为2MSS，第2、3个报文在第二个RTT内发送和接收完毕，拥塞窗口增为4MSS，最后一个报文在第三个RTT内发送和接收完毕。

上面的整个流程花费4个RTT。注意，如果既没考虑三次握手，也没考虑拥塞控制，则可能歪打正着选择B。

## 大题整理

### 2011：IP数据报、以太网MAC帧、ARP、NAT、IP分片、HTTP

![[Pasted image 20231006095120.png]]
（IP分组头结构图略）

第一问：
- Web服务器的IP是`64.170.98.32`。
- 该主机的默认网关的MAC地址是`00-21-27-21-51-ee`。

第二问：
- ARP协议。
- `ff-ff-ff-ff-ff-ff`。

第三问：需要6个RTT。

**第四问**，需要修改TTL、源IP地址和头部校验和字段。注意，如果IP分组长度超过输出链路的MTU，则需要修改总长度字段、标志字段、片偏移字段。

### 2021：DNS、ARP、交换机和交换表、HTTP

![[Pasted image 20231006095217.png]]

第一问：
- 还运行了DNS协议。
- DNS报文->UDP数据报->IP数据报->CSMA/CD帧

**第二问**，S的交换表内容如下：

| MAC地址 | 端口 |
| --- | --- |
| `00-11-22-33-44-cc` | 4 |
| `00-11-22-33-44-bb` | 1 |
| `00-11-22-33-44-aa` | 2 |

t0时刻交换表为空。H1首先发起DNS请求：
- 由于ARP表为空，所以先查本地域名服务器的MAC地址，交换表内增加H1和本地域名服务器的表项。
- H1向本地域名服务器发送DNS请求，域名服务器发回DNS结果。
- H1向路由器先发送ARP请求，路由器响应；再向互联网服务器发送HTTP请求，互联网服务器响应。交换表内增加路由器R的表项。

**第三问**，两个：
- H1向本地域名服务器的ARP请求帧。
- H1向路由器的ARP请求帧。