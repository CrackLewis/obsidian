
## 框架

- 数据链路层的功能
- 组帧
- 差错控制
	- 检错编码（CRC），纠错编码（海明码）
- 流量控制与可靠传输机制
	- 流量控制、可靠传输、滑动窗口机制、停止-等待协议
	- 后退N帧协议（GBN）、选择重传协议（SR）
- 介质访问控制
	- 信道划分：频分多路复用、时分多路复用、波分多路复用、码分多路复用
	- 随机访问：ALOHA协议、CSMA协议、CSMA/CD协议、CSMA/CA协议
	- 令牌传递协议
- 局域网
	- 局域网基本概念和体系结构；以太网和IEEE 802.3
	- IEEE 802.11无线局域网；VLAN基本概念与基本原理
- 广域网
	- 广域网的基本概念
	- PPP协议
- 数据链路层设备
	- 局域网交换机及其工作原理

## 数据链路层功能

- 为网络层提供服务
- 链路管理
- 帧定界、帧同步、透明传输
- 流量控制
- 差错控制

## 组帧方法

- 字符计数法：使用一个计数字段标明帧内字符数
- 字符填充的首尾定界符法：帧首SOH、帧尾EOT、转义ESC
- 零比特填充的首尾标志法：逢5个1补一个0
- 违规编码法

## 差错控制

### 编码的检错和纠错能力

码距为$k$，则检错能力为$k-1$位，纠错能力为$\dfrac{k-1}{2}$位。

### CRC

- 除数多项式是约定好的
- 被除多项式是原始数据
- 余数多项式是校验序列
- 商数多项式P用没有

### 海明码

**海明码位数**：数据位$n$，校验位$k$：
- 检测一位错：$n+k\le 2^k-1$。
- 检测两位错：$n+k+1\le 2^k-1$。

**编码过程**：
- 确定海明码位数
- 确定校验位分布
	- 校验位排列在第$1,2,\cdots,2^{k-1}$位，数据位排列在剩余位置
	- $H_i\equiv P_j$，则$P_j$检验所有的$D_k\equiv H_{p}$，其中$p\wedge i=i$
- 分组以形成校验关系
	- 例如，$n=4,k=3$，则$H_2\equiv H_3\oplus H_6\oplus H_7$，即$P_2\equiv D_1\oplus D_3\oplus D_4$。
- 校验位取值

**校验过程**：
计算$k$个校验位和其校验序列的异或和，例如$n=4,k=3$情形中：
$$
S_2=P_2\oplus D_1\oplus D_3\oplus D_4
$$
如果$S_3S_2S_1=4$，则说明$H_4$出现比特错，需要翻转过来。

## 流量控制与可靠传输

### 基本原理

**发送窗口**：发送方允许发送的帧的序列

**接收窗口**：接收方允许接收的帧的序列

**可靠传输机制**：确认、超时重传（自动重传）。

### 停止等待协议（SW）

发送窗口为1，接收窗口为1。

**异常情形**：丢帧（超时重传），数据帧坏（丢弃重传），ACK坏（发送方重传，接收方重新ACK）。

### 后退N帧协议（GBN）

发送窗口为$1\le W_T\le 2^{n-1}$，接收窗口为$W_R=1$。

**原理**：非阻塞、按序接收、累积确认。

![[Pasted image 20230623163052.png]]

### 选择重传协议（SR）

发送窗口为$1\le W_T\le 2^{n-1}$，接收窗口为$1\le W_R\le 2^{n-1}$。**注意**：还需要额外满足$W_T+W_R\le 2^n$。

**原理**：超时重传、ACK/NAK、选择重传。

![[Pasted image 20230623172858.png]]

## 介质访问控制

### 信道划分手段

**频分多路复用**

**时分多路复用**

**波分多路复用**

**码分多路复用**

**码分多址**（CDMA）

### 随机访问手段

**核心思想**：广播信道转化为点到点信道，各方争用发送权。

#### ALOHA协议

**纯ALOHA协议**：不检测直接发，没确认就重新发。

**时隙ALOHA协议**：与纯ALOHA相比，只能在整时刻发送。

#### CSMA

**原理**：发前监听，会降低冲突可能，提高信道利用率。

![[Pasted image 20230624093826.png]]

**特点**：
- 空闲仍不一定发送：p-坚持CSMA
- 忙时不会坚持监听：非坚持CSMA

#### CSMA/CD（载波监听碰撞检测）

**适用场合**：总线型网络、半双工网络。

**工作流程**：
- 先听后发
- 边听边发：争用期内检测冲突
	- **争用期**：发送时刻后的2倍传播时延之内（$[x_0,x_0+2\tau]$）可能与对方发生冲突。
- 冲突停发：发现碰撞则立刻停发
- 随机重发：截断二进制指数退避算法

**最短帧长**：为了和由于冲突形成的残帧区别，限制最短帧长不少于总线传播时延\*数据传播速率\*2。对于10M以太网，争用期为51.2μs，最短帧长为64B。

**截断二进制指数退避算法**：各自退避随机时间，避免持续冲突。
- 基本退避时间：$2\tau$。
- 退避指数：$k=\min\{重传次数, 10\}$。
- 退避倍数：$0\le r< 2^k$。
- 退避时间：$T=2r\tau$。
- 临界条件：16次重传仍失败，则认为网络过于拥挤，抛弃该帧并报错。

#### CSMA/CA协议

**适用场合**：无线局域网。

**帧间间隔**：所有站点发完帧后都必须等待一段很短的时间，才能发送下一帧。
- 类别：SIFS\<PIFS\<DIFS。
	- SIFS：CTS、ACK、数据帧和其他控制帧。
	- DIFS：隐蔽站内RTS。

**工作流程**：
- 起步：最初发数据前，若空闲则先等待DIFS再发。
- 退避：如忙则执行退避算法，如仍忙则退避计时器不变，如闲则开始倒计时。
- 发送：退避计时器归零时，发送整个帧，等待确认。
- 继续：若被ACK且要发送后续帧，则重新开始执行退避步骤。

**退避算法**：与截断二进制退避算法相似，有一些不同点。
- 争用窗口
- 使用情形：发下一帧、重传、信道忙。
- 不使用情形：第一帧。

#### 隐蔽站问题

![[Pasted image 20230624123500.png]]

### 轮询访问手段

**令牌传递协议**：
- 空闲：令牌空转
- 发射：站点发送数据前将数据附加到令牌上，并发送
- 传播：令牌绕一圈，接收方会复制一份
- 检验：发送者检验帧的正确性
- 释放：发送者释放令牌

**特点**：对负载重的网络较友好。

## 局域网

**要素**：拓扑结构、传输介质、介质访问控制方式。

**逻辑链路控制子层**（LLC）

### 以太网（IEEE 802.3）

**特点**：
- 逻辑结构：总线形
- 方便性和可靠性：CSMA/CD
- 通信简化措施：曼彻斯特编码、无连接工作方式

**分类**：必背！
![[Pasted image 20230624142427.png]]
- 100BASE-T：全/半双工，100Mbps，双绞线，CSMA/CD（仅半双工），电缆最长100m。
- 吉比特以太网：1Gbps，全/半双工。
- 10吉比特以太网：10Gbps，全双工，光纤，不使用CSMA/CD。

**网络接口卡**（NIC）

**MAC地址**

**以太网的MAC帧**：必背！
![[Pasted image 20230624150737.png]]

### 无线局域网（IEEE 802.11）

**有固定基础设施的无线局域网**：比较琐碎，详见[[CN03-数据链路层#^7d23bf]]。
- 基本服务集
- 接入点
- 分配系统

**无固定基础设施移动自组织网络**

**IEEE802.11 MAC帧**：
![[Pasted image 20230624182806.png]]
- **四个地址**：
	- 含义：1（直接接收地址）、2（实际发送地址）、3（冗余地址）、4（自组网络用）
	- 取值：
		- 来自AP：1目的、2AP、3源地址
		- 去往AP：1AP、2源地址、3目的

### VLAN

**特点**：地理无关、网络无关、基于交换技术，是一种局域网服务。

IEEE 802.3ac

## 广域网

**特点**：包含网络层，区域极广，强调资源共享。

### PPP协议

**目的**：作为一种点对点互连的简单解决方案。

**特点**：差错检测、仅点对点、仅全双工、面向字节、与网络层协议无关。

详细内容见[[CN03-数据链路层#PPP协议]]。

## 以太网交换机

**原理**：基于MAC查找表的多端口网桥。

**作用**：管理开销低廉，简化网络变化的操作，实现VLAN方便。

**特点**：一般为全双工、即插即用、交换速率高、多口连通。

**交换模式**：直通式交换机、存储转发式交换机。

**自学习功能**：
- 基本操作：过滤、转发
- 交换表：`<MAC地址,连通端口>`。
- 流程：登记新的发送方，通过广播认识新的接收方。

## 解题

### ALOHA协议的最大信道利用率

纯ALOHA协议：$\eta=Ge^{-2G}$，最大值为$\dfrac{1}{2e}$。

时隙ALOHA协议：$\eta=Ge^{-G}$，最大值为$\dfrac{1}{e}$。

### 滑动窗口协议的信道利用率

发送信道利用率=(发送窗口容量\*单帧发出时间)/(往返时延+单帧发出时间+ACK发出时间)

## 选择题整理-非真题

### 3.1-数据链路层功能

![[Pasted image 20231002193427.png]]

3题选D。帧编号更多是一种标识帧的手段，不仅仅是解决丢帧的问题；计时器超时重发机制可以避免帧的丢失。

**4题选C**。面向连接的服务必定包括确认。

![[Pasted image 20231002193751.png]]

7题选A。ICMP是网络层协议，SLIP（Serial Line Internet Protocol）是一种简单的串行通信协议，属于链路层协议。

### 3.2-组帧

WIP

### 3.3-差错控制

![[Pasted image 20231002194125.png]]

1题选A。本题是抠字眼题，注意信道固有的热噪声引发的差错叫**随机差错**，外界电磁干扰引起的冲击噪声引发的差错叫**突发差错**。随机差错可以通过提高信道的信噪比解决。

### 3.4-流量控制与可靠传输机制

![[Pasted image 20231002195713.png]]
![[Pasted image 20231002195720.png]]

8题选B。容易误选C。注意如果允许$n$帧未确认，则可能出现无法区分新旧帧的情形。

### 3.5-介质访问控制

![[Pasted image 20231002214256.png]]

11题选D。通过长度和信号传播速率计算得单向传播时延为0.05ms，双向传播时延即争用期则为0.1ms。传播速率为10Mb/s时，最短帧长为1000bit。

![[Pasted image 20231002214609.png]]

15题选B。令牌环网不会因为网络负载重就产生冲突，而CSMA/CD不是。

![[Pasted image 20231002214734.png]]

**17题选B**。不需要冲突检测的原因有两点：第一点是接收信号的强度往往远小于发送信号的强度；第二点是有屏蔽站问题，收发双方不一定能听见对方。A项说法错误，双方都能收发；C项，无线信号也会产生冲突；D项，不是主因。

### 3.6-局域网

![[Pasted image 20231002230428.png]]

11题选D。10吉比特以太网换用了光纤，只在全双工模式下工作，不使用CSMA/CD协议。

![[Pasted image 20231002230436.png]]

13题选C。王道书上并未过多着墨**逻辑链路控制子层（LLC）**，但MAC负责的是组帧和拆帧、寻址、竞争、差错检测的工作，而逻辑连接管理、差错控制、帧定序则是LLC的工作。

![[Pasted image 20231002230445.png]]

**15题选B**。以太网会将发送者的数据广播给所有主机，接收与否要看主机是否为该帧的接收者。

16题选B。介质的说法过于绝对，IEEE 802.3z标准使用光纤，IEEE 802.3ab则使用4对UTP5类线。

### 3.7-广域网

![[Pasted image 20231003010603.png]]

**1题选C**。A错，广域网是单一网络；B错，局域网没有网络层；D错，局域网不一定是以太网，也不一定是总线形结构。

![[Pasted image 20231003010624.png]]

3题选B。广域网的通信子网主要使用分组交换技术，将不同地区的计算机系统或局域网互联起来。

![[Pasted image 20231003010639.png]]

5题选B。PPP是一种面向字符的协议，所有的帧长度都是整数个字节，使用字符填充法。

6题选B。PPP是链路层协议，对其上层协议不作限制。

![[Pasted image 20231003010653.png]]

8题选A。PPP协议的地址和控制域是常量，所以LCP提供了必要的机制。

### 3.8-链路层设备

![[Pasted image 20231003012834.png]]

12题选D、A。第一个D无争议，第二个选项要注意题干为**半双工交换机**，所以交换机总容量要减半，即为120Mb/s。

## 选择题整理-真题

![[Pasted image 20231002202250.png]]

13题选B。数据帧的长度不确定，如果是为了确保任何情况下信道利用率最高，则需要按最小帧长考虑（帧长越大则利用率越高）。发送一个最小帧的时间是128B\*8/16(kb/s)=64ms，因此一帧从发出到确认完毕的总耗时是64+64+270\*2=668ms，这个时间段内，发送方可以发送668/64=10.4帧。因此需要至少4位帧序号。

![[Pasted image 20231002202645.png]]
![[Pasted image 20231002202652.png]]

17题选B。根据题干可知，这个协议可能是GBN或SR协议。对于GBN，接收窗口只能取1；对于SR，需要满足发送窗口和接收窗口之和不超过$2^n$（否则新旧帧会混淆）。因此答案选B。

![[Pasted image 20231002214755.png]]

24题选D。ACK是CSMA/CA避免冲突的独有机制，只有发送方收到接收方发回的ACK，才确认已正确发送。

![[Pasted image 20231002214850.png]]

31题选A。无线局域网内的帧间等待时间分为三种：SIFS、PIFS、DIFS。发RTS前要等一个DIFS（时间最长），发CTS、数据和ACK之前各要等一个SIFS（时间最短）。

![[Pasted image 20231002231123.png]]

21题选B。发向AP的IEEE 802.11数据帧中，地址1、2、3分别代表AP地址、发送者地址和接收者地址。

![[Pasted image 20231003013030.png]]

16题选B。注意交换机的**直通交换**方式只检查帧的目的地址，因此引入的转发时延为6B\*8/100(Mb/s)=0.48μs，其中6B为MAC地址长度。

## 大题整理

### 2017：后退N帧协议

![[Pasted image 20231002203308.png]]
![[Pasted image 20231002203316.png]]

第一问，t1时刻前乙方发送的最后一个帧确认序号为3，说明乙方正确接收了0、1、2三个帧。

**第二问**，在GBR协议中，由于序号数有3位，所以帧序号有8个，因此发送窗口的最大容量不超过7。t1时刻，甲方发送的3、4号帧未被确认，因此还能再发5个帧。

第三问，需要重发3个帧。重发的第一个帧是`S2,2`。

**第四问**，易于计算甲方发送一个帧耗时0.08ms，**往返时延**（RTT）0.96ms。甲方可以达到的最大信道利用率是：
$$
\dfrac{7\times 0.08}{0.96+2\times 0.08}=50\%
$$
甲方在数据帧得到乙方确认之前，可以一次发7帧。开始发第一帧到其被确认的最短时间是往返时延加2倍发出时间。

### 2010：CSMA/CD、以太网MAC帧

![[Pasted image 20231002220604.png]]

第一问：
- 最短情形是双方同时发送，一倍时延后双方均得知发生了冲突，耗时0.01ms。
- 最长情形是一方发送到另一方时，另一方刚开始发送，先发送方在发送两倍时延后才知道发生了冲突，耗时0.02ms。

**第二问**：
一个以太网MAC帧的最大有效信息有1500B。以太网数据帧和确认帧的总发送用时为：
$$
\dfrac{(1518+64)\times 8}{10^8}=1.2656\times 10^3\text{s}=1.2656\text{ms}
$$
主机甲的有效传输速率等于有效数据量除以总时延（传播时延、发送用时）：
$$
\dfrac{1500\times 8}{(1.2656+0.02)\times 10^{-3}}=9.33\text{Mb/s}
$$
