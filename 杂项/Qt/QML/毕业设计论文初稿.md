
## 总体设计

### 可行性分析（略）

### 需求分析

#### 功能需求

平台需作为显示终端程序的一部分或主体，并实现如下功能：
- 接收并解析主控程序发送的动态地图样式描述，包括动态地图的结构描述和所使用的字体、图像等文件。
- 接收并解析主控程序发送的动态地图线路数据，包括线路的名称、主题色、沿线各站中英文名、线路拓扑结构等信息。
- 根据解析完毕的动态地图样式描述和线路数据信息，实现线路动态地图的自动生成和在终端上的显示。
- 接收并解析主控程序发送的列车实时状态信息，包括日期时间、列车位置、到站状态、开门侧、车门状态、紧急广播等信息，并根据这些信息更新动态地图。
- 拉取动态地图需要拉取的视频流，并正确呈现在动态地图的对应位置。

为进行功能验证，需要编写能够与平台通信的主控系统模拟程序，主控系统模拟程序需完成如下功能：
- 发现程序主机所在广播域内的显示终端，并建立与这些终端的连接。
- 选取存储在本地的动态地图样式描述和样式数据，发送给显示终端。
- 通过操作程序界面修改列车的实时运行状态，并以定时自动发送和手动发送两种方式发送运行状态给显示终端。
- 向显示终端通知视频流地址，以便显示终端启动拉流；实现本地文件的推流功能，以便测试视频流功能。

本文所称主控程序，均指车载PIS主控系统模拟程序，不考虑轨道交通指挥中心PIS、多线路中心PIS、单线路中心PIS等高级PIS主控系统的影响。

本文所称地图平台、地图生成平台、动态地图平台、动态地图生成平台，均指地铁动态地图自动生成平台。

#### 技术需求

平台需运行于x86或ARM架构的通用计算机和嵌入式计算机下，主机应至少具备2个处理器核心和4GB内存，操作系统为Linux。主控程序需运行于x86架构的通用计算机下，主机应至少具备4个处理器核心和8GB内存，操作系统为Windows或Linux。

平台所在主机需要与主控程序处于同一广播域，以便与主控程序实现信息交换。平台和主控程序需要实现基于TCP套接字的网络连接，通过可靠连接传输动态地图的样式描述、线路数据等内容；需要实现广播或组播套接字，通过该套接字进行网络发现、定期点名和发送列车实时状态等操作。

考虑到平台可能需要在动态地图内播放视频，故平台需要根据主控程序的指令拉取网络视频流并逐帧转码为合适的图像格式，以便在地图界面上实时显示，与此同时主控程序需要通过网络指令实现视频流的播放控制。

### 总体设计方案

动态地图生成平台为Qt Quick程序，运行于显示终端，除连接到终端显示屏外，还通过TCP和UDP端口连接到网络上的主控程序。TCP端口负责传输样式描述、线路数据等高可靠性要求的数据；UDP端口负责通过主控程序指令建立和维护连接，同时传输列车运行状态等低可靠性要求的数据。

主控程序为Qt Widget程序，运行于车载通用计算机，该计算机应在本地存储地图生成所必需的样式描述文件和线路数据文件，并确保与各显示终端连接到同一局域网。主控程序维护一个存有与各显示终端连接的TCP连接池用于发送可靠数据，另维护一个UDP端口用于发送连接指令和列车状态数据。

动态地图生成平台设计为5个子模块：
- 样式描述解析模块：从TCP端口接收并解析样式描述文件，解析结果呈递地图生成模块。
- 线路数据解析模块：从TCP端口接收并解析线路数据，解析结果呈递地图生成模块。
- 列车状态解析模块：从UDP端口接收并解析列车的实时运行状态，根据运行状态更新动态地图中的对应内容。
- 视频流拉取模块：根据主控程序的命令创建或销毁拉流线程，拉流线程负责拉取指定网络地址的RTSP视频流，并将视频帧转码为RGB图像显示于动态地图的指定位置。
- 地图生成模块：根据解析模块的解析结果，运用动态地图生成算法生成动态地图，将地图全屏显示于显示终端。

主控程序设计为用户界面和4个子模块：
- 用户界面：为程序各项主要功能提供可操作图形化界面。
- 样式描述加载模块：从用户指定的本地目录加载样式描述文件，通过TCP端口发送。
- 线路数据加载模块：从用户指定的本地目录加载线路数据文件，通过TCP端口发送。
- 列车状态发送模块：以定时自动发送或手动发送方式之一，将当前的列车运行状态通过UDP端口组播发送。
- 视频流控制模块：通过UDP端口发送视频流创建和销毁命令；允许从指定的本地视频启动RTSP推流。

### 总体设计框图

根据前文的总体设计方案，绘制总体设计框图如下所示：

![[cumulative_design.png]]

## 详细设计

基于前面的总体设计部分，对各模块进行详细设计如下。

### 程序流程设计

主控程序和地图生成平台都通过有限状态机实现程序流程的控制。在任一时刻，程序必处于一个合法状态，而在指定的事件发生时，会迁移到另一个合法状态。

主控程序的UML状态图如下所示：

![[controller_fsm.png]]

主控程序共设6个主要状态，包括复位状态、4个准备状态和运行状态。

复位状态是程序的初始状态，也是为程序方便使用设计的一种特殊状态。在程序处于任意的其他状态时发出复位指令，均可使程序转换为复位指令。转换为复位状态时执行的操作包括但不限于：断开所有活动的TCP连接，恢复界面为初始状态，对所有变量赋予初始值。复位状态下可通过发现流程建立与显示终端的连接，从而转移到准备状态，发现流程的细节在网络接口设计部分阐述。

准备状态根据主控程序是否传送了样式描述和线路数据，分为4个子状态。完成样式描述文件和线路数据文件的传送会使程序最终转移到就绪状态，就绪状态时执行启动命令可转换为运行状态。

运行状态下，主控程序可向显示终端发送列车运行状态，可执行视频流的建立和销毁等命令。

动态地图生成平台的UML状态图如下所示：

![[display_fsm.png]]

与主控程序类似，动态地图生成平台也设6个主要状态：复位指令、运行状态和4个准备状态，准备状态也根据是否收到样式描述和线路数据区分。不同的是：复位状态需通过主控程序断开连接触发；在主控端执行启动指令后，地图平台不会立即开始运作，而是会推迟到首次接收到列车运行状态时生成并显示地图。

### 网络接口设计

主控程序维护3个网络设施：
- TCP监听套接字：建立在主机的固定端口上，监听来自显示终端的连接请求。用QTcpServer实现。
- TCP连接池：存储与每个显示终端的TCP连接。用从套接字地址到QTcpSocket指针的带锁哈希表实现。
- UDP套接字：加入组播组，向组内的显示终端发送连接命令和列车状态数据。用QUdpSocket实现。

地图生成平台维护两个网络设施：
- TCP套接字：与主控程序连接，接收样式描述和线路数据。用QTcpSocket实现。
- UDP套接字：加入组播组，接收主控程序发送的连接命令和列车状态数据。用QUdpSocket实现。

主控程序与地图生成平台通过“发现”方式建立连接，这种方式借鉴了动态主机配置协议（Dynamic Host Configuration Protocol，DHCP）的思想：
- 主控程序每隔200ms，通过UDP套接字发送一个“发现”报文，报文内有识别校验字段和主控程序监听套接字的IP、端口号，总共发送10次。
- 地图生成平台在首次接收到“发现”报文时，通过该监听套接字请求建立TCP连接，主控程序验证后将连接加入TCP连接池。
- 发出发现指令3s后，停止发现流程，如连接到显示终端，则主控程序进入已连接状态，否则仍为复位状态。

在TCP套接字上传送大量数据可能遇到分片问题和粘包问题：在接收方处，数据可能不会按照发送方调用send函数的次序划分，而可能出现单次发送数据分多次被接收，或多次发送的数据一次接收完的情形。为解决这些问题，所有的TCP数据前附加8个字节：前4个字节标识TCP数据的类型（样式描述、线路数据或其他），后4个字节标识数据的长度。发送方在发送数据前先发送8字节前缀，而接收方会根据接收到的前8字节判断数据类型和长度，并持续读取直到读取完毕；如有冗余数据，则其会被截取并作为下一份TCP数据的开头。

UDP套接字的使用涉及IPv4组播技术。组播是一种由单主机发送数据给一组目标主机的传输方式，相较于单播而言可以节约网络带宽，与广播相比可以跨网段传输信息。主控程序通过组播技术传送指令和列车状态数据，可以有效降低网络负载。

### 样式描述模块设计

#### 样式描述结构

动态地图的样式描述是一组定义和描述地图结构和元素组成的文件。本项目支持的样式描述格式为单个文件目录，内包含如下成员：
- `qmldir`文件：QML模块目录文件，内包含本目录下欲使用的其他QML文件声明。
- `map.qml`文件：QML文件，描述地图的结构和元素组成。
- 其他QML文件、地图使用到的字体、图片资源等。

目前常见的描述界面结构的声明式语言主要有HTML、SVG、QML等。本项目选用QML作为描述界面所用的语言，鉴于其几项独特的优势：
- 可通过内联JavaScript描述界面的自定义行为。
- 可使用在C++程序内定义的一些Qt对象类型和单体类型。
- 有相对丰富的QtQuick模块支持，提供了常见的布局器、流程控制、窗口控制等功能。
- 使用了Qt的图像硬件加速技术，界面显示更加方便。相比之下，HTML界面只能在QtWebEngine模块支持的界面中显示。
- 模块复用方便，且支持动态加载外部QML。这也使得通过网络传输外部QML代码并加载成为现实。

以本项目在开发期间使用的一个样式描述为例：该样式目录有如下成员：

```
MetroMap
+- qmldir
+- map.qml
+- figures
|  +- shmetro.png
+- fonts
   +- simhei.ttf
   +- arial.ttf
```

其中`figures`存储了样式使用到的图片资源，`fonts`存储了样式使用到的字体资源，它们被目录下的`map.qml`索引并使用。

#### 样式描述传输格式

主控程序在加载样式描述目录后，需要将目录打包发送至各显示终端。目录的打包格式如下：

| 编号  | 字节长度 | 格式  | 项目                     |
| --- | ---- | --- | ---------------------- |
| 1   | 8    | INT | TCP数据标识字节              |
| 2   | 4    | INT | 目录下的一级成员数量，包括一级文件和一级目录 |
| 3   | 变量   | 不适用 | 依次排列各文件成员和目录成员         |

文件成员的格式如下：

| 编号  | 字节长度 | 格式   | 项目           |
| --- | ---- | ---- | ------------ |
| 1   | 4    | INT  | 定值0，表示该成员为文件 |
| 2   | 52   | CHAR | 成员的文件名       |
| 3   | 4    | INT  | 文件长度，以字节数计   |
| 4   | 4    | 不适用  | 保留成员         |
| 5   | 变量   | 不适用  | 文件内容         |

目录成员的格式如下：

| 编号  | 字节长度 | 格式   | 项目           |
| --- | ---- | ---- | ------------ |
| 1   | 4    | INT  | 定值1，表示该成员为目录 |
| 2   | 52   | CHAR | 成员的目录名       |
| 3   | 4    | INT  | 该目录下文件成员的数量  |
| 4   | 4    | 不适用  | 保留成员         |
| 5   | 变量   | 不适用  | 目录下的各文件成员    |

整个目录在通过上述方式打包后，会形成一个TCP字节流，该字节流发送到显示终端后，可由地图生成平台按上述格式进行解包，存储到显示终端的指定目录，以便随后进行地图生成与显示。

### 线路数据模块设计

#### 线路数据源

本项目的设计允许用户从本地加载轨道交通系统的整个网络，并从整个网络的所有可行区间中挑选一个作为使用的地铁线路数据。

轨道交通系统网络在本地是一个包含数个JSON文件的目录：
- `root.json`：记录了网络内的所有线路名称和站点中英文名。
- `<线路名>.json`：每个合法线路对应一个线路文件，记录了线路的主题色、中英文名、编号、组成区间和端点等信息。

考虑到上海地铁系统比较复杂，这里仅截取部分文件片段说明。这是`root.json`的部分内容：

```json
{
	"lines": [ "1号线", "2号线", "10号线", ... ],
	"stations": [
		{ "name": "同济大学", "ename": "Tongji University" },
		{ "name": "五角场", "ename": "Wujiaochang" },
		...
	]
}
```

这是`10号线.json`的部分内容：

```json
{
    "color": 4290750719,
    "name": "10号线",
    "number": 10,
    "ends": [ "基隆路", "虹桥火车站", "航中路" ],
    "periods": [
        { "sta": "国权路", "stb": "同济大学" },
        { "sta": "同济大学", "stb": "四平路" },
        ...
    ]
}
```

#### 线路数据生成算法

主控平台在加载并检查轨道交通系统网络目录后，会运用深度优先搜索算法逐线路遍历，计算得到每条地铁线路的大致运行区间。

例如，上海地铁10号线的大致运行区间有6个：虹桥火车站到基隆路区间，虹桥火车站到航中路区间（实际不可行），基隆路到虹桥火车站区间，基隆路到航中路区间，航中路到虹桥火车站区间（实际不可行），航中路到基隆路区间。考虑到地铁的实际运营情况可能和计算结果有差别，并非所有大致运行区间都是实际可行区间，实际选择时仍需人为甄别。

深度优先搜索算法遍历线路的流程如下：
1. **初始化上下文**：
    - `RouteTraverseContext`包含了当前遍历的状态，包括站点栈、转乘列表、已访问的站点、站点名称映射、站点邻接关系、线路信息、线路终点信息以及回调函数。
2. **遍历线路**（`traverse_line`函数）：
    - **获取当前站点**：从站点栈中获取当前处理的站点。
    - **确定邻接站点和转乘站点**：遍历当前站点的邻接站点，如果邻接站点属于当前线路，则加入邻接站集合；如果属于其他线路，则加入转乘集合。
    - **处理转乘信息**：将所有转乘线路的信息添加到转乘列表中，并更新当前站点的转乘列表。
    - **确定下一步动作**：
        - **找到邻接站点**：确定当前站点的未访问邻接站点，如果未访问的邻接站点数量为0，说明当前分支遍历完毕，需要进行结算。
        - **处理结算情况**：
            - 如果形成闭环，则添加起始站点作为结束站点，处理转乘信息，并生成完整的线路数据包，调用回调函数处理。
            - 处理完毕后，弹出转乘信息，回溯到上一个站点。
        - **处理搜索情况**：
            - 将当前站点标记为已访问。
            - 对于每一个未访问的邻接站点，递归调用`traverse_line`函数进行进一步的深度优先搜索。
            - 搜索完毕后，将当前站点从已访问集合中移除。
    - **回溯**：在搜索或结算之后，弹出转乘信息，回到上一个站点，继续处理其他可能的路径。
3. **生成线路数据包**：
    - 在找到完整的路径后，生成一个包含线路名称、线路颜色、站点数量、转乘数量、站点信息和转乘信息的线路数据包。
    - 调用预定义的回调函数，将生成的线路数据包传递出去进行进一步处理。

#### 线路数据传输格式

通过线路数据生成算法，可以得到所有地铁线路的所有大致运行区间，每个运行区间对应一份备选的线路数据。

地铁线路数据总共14292字节，采用下列格式：

| 编号  | 字节长度    | 格式   | 项目                            |
| --- | ------- | ---- | ----------------------------- |
| 1   | 8       | INT  | TCP数据标识字节                     |
| 2   | 64      | CHAR | 线路全名                          |
| 3   | 4       | INT  | 线路主题色，值为32位RGBA值              |
| 4   | 4       | INT  | 沿线站点                          |
| 5   | 4       | INT  | 沿线换乘节点个数（不同站点或不同目标线路视为不同换乘节点） |
| 6   | 156\*48 | 不适用  | 沿线站点信息                        |
| 7   | 140\*48 | 不适用  | 沿线换乘节点信息                      |

沿线站点信息最多48条，从起点站到终点站依次排列。每条信息156字节，具体结构如下：

| 编号  | 字节长度 | 格式   | 项目               |
| --- | ---- | ---- | ---------------- |
| 1   | 64   | CHAR | 站点中文名            |
| 2   | 64   | CHAR | 站点英文名            |
| 3   | 4    | INT  | 站点编号，下标为1        |
| 4   | 6\*4 | INT  | 换乘节点编号，下标为1，默认为0 |

沿线换乘信息最多48条，记录每个换乘站点的每条目标换乘线路。每条信息140字节，具体结构如下：

| 编号  | 字节长度 | 格式   | 项目                 |
| --- | ---- | ---- | ------------------ |
| 1   | 4    | INT  | 换乘线路编号             |
| 2   | 64   | CHAR | 换乘线路中文名            |
| 3   | 64   | CHAR | 换乘线路后缀部分           |
| 4   | 4    | INT  | 换乘线路主题色，值为32位RGBA值 |
| 5   | 4    | INT  | 换乘线路所在站点的ID，下标为1   |

### 列车状态模块设计

列车实时运行状态是一组描述列车当前时刻运行情况的变量。这些变量不会参与到动态地图的生成，也不能在地图运行前确定，只能由主控程序在运行期间提供。在地图生成平台运行期间，列车状态报文会通过UDP端口组播给各显示终端。

列车状态报文的数据部分总共64字节，采用下列格式：

| 编号  | 字节长度  | 格式    | 项目                     |
| --- | ----- | ----- | ---------------------- |
| 1   | 4     | INT   | 报文类型标识                 |
| 2   | 4     | INT   | 全局状态字                  |
| 3   | 8     | LONG  | 日期时间戳，值为自UNIX纪元起经过的毫秒数 |
| 4   | 8     | LONG  | 越站标志                   |
| 5   | 1     | BYTE  | 当前站ID                  |
| 6   | 1     | BYTE  | 下一站ID                  |
| 7   | 2     | SHORT | 到站剩余时间，单位为秒            |
| 8   | 4     | 不适用   | 保留                     |
| 9   | 4     | INT   | 车厢控制状态字                |
| 10  | 1     | BYTE  | 终端亮度，范围为0至100          |
| 11  | 1     | BYTE  | 终端音量，范围为0至100          |
| 12  | 1     | BYTE  | 紧急广播ID                 |
| 13  | 1     | BYTE  | 紧急广播参数                 |
| 14  | 12\*1 | BYTE  | 车门状态字                  |
| 15  | 12    | 不适用   | 保留                     |

全局状态字表示对整辆列车有效的变量，目前使用7个二进制位：
- 开门位：表示列车当前是否为开门状态。
- 关门位：表示列车当前是否为关门状态。
- 预到站状态位：表示列车当前是否为预到站状态。
- 到站状态位：表示列车当前是否为到站状态。
- 离站状态位：表示列车当前是否为离站状态。
- 行进中状态位：表示列车当前是否为行进状态。
- 紧急广播有效位：表示当前是否需要播放的紧急广播。

车厢控制状态字表示对单个车厢内所有终端有效的变量，目前使用6个二进制位：
- TC1激活位：表示当前拖车为TC1。
- TC2激活位：表示当前拖车为TC2。
- 左侧开门位：表示当前行进方向的左侧开门。
- 右侧开门位：表示当前行进方向的右侧开门。
- 音量有效位：表示音量设置有效。
- 亮度有效位：表示亮度设置有效。

### 地图生成模块设计

前文讨论过，动态地图的自动生成依赖于主控程序提供的样式描述和线路数据，而生成过程则依赖于动态地图的生成算法。

生成过程大致分以下三步：
- 从本地加载缓存的样式描述目录中的`map.qml`文件，作为动态地图的界面组成。
- 将收到的线路数据通过类型注入机制填入QML，作为动态地图的数据组成。
- 运用布局算法自顶向下计算各级QML元素的位置，确定最终布局。

#### 地图元素布局算法

每个QML文件本质上是一棵QML元素树，外层元素通过嵌套内层元素形成层次关系，一个父元素会对应若干个子元素。所有元素采用矩形模型，通过左上顶点的坐标和宽、高确定元素范围。子元素的绝对坐标$(x,y)$通过子元素在父元素内的相对坐标$(x_0,y_0)$和父元素的绝对坐标$(x_1,y_1)$确定：
$$
(x,y)=(x_0,y_0)+(x_1,y_1)
$$
设某元素相对坐标为$(x_0,y_0)$，各级父元素相对坐标为$(x_i,y_i)$（$i=1,2,\dots,n$），则该元素的绝对坐标为：
$$
(x,y)=\sum_{i=0}^n (x_i,y_i)
$$

QML元素在父元素内的定位有3种方式：
- 固定相对坐标：指定相对坐标为定表达式。
- 锚线定位：将元素的水平锚线（顶、底、水平中线）和竖直锚线（左、右、竖直中线）与父元素的对应方向锚线固定，允许设置固定长度的偏移。
- 布局器定位：运用QML Layout提供的布局器模块将一系列元素固定在一行、一列或一个网格内，其具体尺寸和相对位置由各元素的尺寸参数决定。

对于固定相对坐标的元素，不需要确定其相对坐标；对于锚线定位的元素，其相对坐标需要先与父元素的锚定位置绑定，再按照偏移值偏移对应距离。例如：设父元素绝对坐标$(x_1,y_1)$，尺寸为$(w_1,h_1)$，子元素尺寸为$(w_0,h_0)$，偏移值为$(p,q)$，若子元素的右下角与父元素的右上角绑定，则子元素的相对坐标为：
$$
(x_0,y_0)=(w_1-w_0+p,-h_0+q)
$$

对于通过布局器定位的元素，其需要指定如下属性：
- 布局策略：不超过预期宽高、最大填充。
- 对齐策略：元素在布局器内采用何种对齐方式。
- 宽度、高度的最小值、最大值和期望值。

QML布局器分为3种：行布局器RowLayout、列布局器ColumnLayout和网格布局器GridLayout。以行布局器为例，该布局器会将所有子元素排列在一行内，根据布局器元素的所占大小分情况计算元素的实际宽度。设行布局器内有$n$个采用“不超过预期宽度”策略（简记为“保守”策略）的元素，其最小、预期、最大宽度为$0<A_i\le B_i\le C_i$（$i=1,2,\dots,n$）；有$m$个采用“最大宽度填充”策略（简记为“扩张”策略）的元素，其最小、预期、最大宽度为$0<A_j\le B_j\le C_j$（$j=n+1,n+2,\dots,n+m$）。

第一种情形，若布局器宽度$W$不大于各元素最小宽度之和，则元素按最小宽度依次排列，末端可能溢出布局器。第$i$个元素的实际宽度$D_i$为：
$$
D_i=A_i,i=1,2,\dots,n+m
$$

第二种情形，若布局器宽度$W$大于各元素最小宽度之和，不大于各元素预期宽度之和，则元素以预期宽度与最小宽度的差为权值计算实际宽度。第$i$个元素的实际宽度$D_i$为：
$$
D_i=A_i+\dfrac{W-\displaystyle\sum_{j=1}^{n+m} A_j}{\displaystyle\sum_{j=1}^{n+m} (B_j-A_j)}(B_i-A_i),i=1,2,\dots,n+m
$$

第三种情形，若布局器宽度$W$大于各元素预期宽度之和，不大于各元素最大宽度之和，则采用“保守”策略的元素按预期宽度设置实际宽度，其余元素以最大宽度与预期宽度之差为权值扩大宽度。第$i$个元素的实际宽度$D_i$为：
$$
D_i=\left\{\begin{matrix}
B_i, & i=1,2,\dots,n, \\
B_i+\dfrac{W-\displaystyle\sum_{j=1}^{n+m} B_j}{\displaystyle\sum_{j=n+1}^{n+m} (C_j-B_j)}(C_i-B_i), & i=n+1,n+2,\dots,n+m.
\end{matrix}\right.
$$

第四种情形，若布局器宽度$W$大于采用“保守”策略元素的预期宽度之和与采用“扩张”策略元素的最大宽度之和，则前者按预期宽度确定实际宽度，后者按最大宽度确定实际宽度。第$i$个元素的实际宽度$D_i$为：
$$
D_i=\left\{\begin{matrix}
B_i, & i=1,2,\dots,n,\\
C_i, & i=n+1,n+2,\dots,n+m.
\end{matrix}\right.
$$

元素在列布局器内的相对横坐标由其左侧所有元素的实际宽度确定，相对纵坐标则由对齐方式确定，例如：上对齐时相对纵坐标为0，下对齐时相对纵坐标为布局器高度与元素高度的差。

行布局器的思想和列布局器类似。网格布局器比较特殊，它需要依次排列每个元素，再综合行布局和列布局算法确定网格内每个元素的实际宽度、高度。

#### 地图生成方法描述

构建动态地图界面过程的本质是在显示终端界面上搭建一颗包含动态地图所有元素的QML元素树的过程。地图的结构细节、静态内容均已由样式描述确定，所以关键问题是如何将线路数据填入QML元素树内。

地图平台的设计方案是：在地图生成前，将线路数据填入在C++内定义的QML Singleton（单体）类型，在地图生成时触发地图初始化槽函数，将单体类型内的线路数据填入QML线路数据的ListModel（列表模型）内，通过Repeater将每个线路数据结构都初始化为站点QML元素，作为站点列布局器的子元素。

## 平台实现

### 主控程序实现

主控程序为C++程序，使用如下编译器和第三方库：
- 编译器：GCC 5.4.0
- 第三方库：
	- FFmpeg：4.4.4
	- Qt Core、Qt GUI、Qt Network：5.12.5

主控程序分为界面部分和逻辑部分。界面部分描述主控程序的界面组成，连接界面组件到逻辑部分的对应模块；逻辑部分定义各个功能模块的行为，实际执行用户的指令。下面是主控程序的UML类图：

