
基本信息：
- 主课+课程实验+xv6源码分析+课堂讨论
- 课程：
	- PKU课程：
	- mooc：
	- GitHub仓库：[repo](https://github.com/wuhao9714/myNachos3.4)
- 参考资料：[OSTEP](https://pages.cs.wisc.edu/~remzi/OSTEP/)、《现代操作系统》、《》
- 课程评定：60平时（35课程实验+10源码阅读+15课堂互动）+40考试=100

xv6：
- src: MIT
- 支持对称多处理器（SMP）和RISC-V架构

读代码：
- kernel/entry.S, kernel/start.c, kernel/memlayout.h, kernel/main.c
- kernel/trap.c, kernel/trampoline.S, kernel/syscall.h, kernel/syscall.c, kernel/kernelvec.S, kernel/console.c, kernel/uart.c

lab:
- lab评测平台已导入各位同学的账号，请访问course.educg.net登录，账号为pku+你的学号，例如pku2400011223，初始密码为pku123456。
- 其他有关平台提交lab的使用方式和注意事项请参考本文档：[文档](https://oyer359xyx.feishu.cn/docx/HUOldvsKvojKq4xFGGPc8n42nPc)
- 简单写了下本课程使用的lab的环境配置等问题的指导，9月27日课程上也会讲解lab环境配置和提交方式。有时间精力的同学可以参照本文档开始在本地做lab了：[文档](https://oyer359xyx.feishu.cn/docx/SGDNdxCkuoMSV6xUgX5cPJCTnMe)

这个RISC-V中断机制讲的不错：[lnk](https://gitee.com/hustos/pke-doc/blob/master/chapter1_riscv.md#14-%E4%B8%AD%E6%96%AD%E5%92%8C%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86)

## OS实验

不知为何，默认SBI可以启动，但rustsbi启动不了：

```sh
make run SBIPATH=default # OK
make run SBI=sbi-qemu-2 # fail
```

UPD: 实锤是辣鸡clab主机的锅，换Docker就好了（

基于QEMU和GDB的调试：
- 首先在QEMUOPTS中加`-s`，表示在默认端口1234上调试（自定义端口`-s tcp::<port>`）
- 启动`gdb-multiarch`或交叉编辑器的`gdb`，目标程序为内核
- GDB内执行`target remote:<port>`，如为默认端口则port为1234
- 设置必要的断点，如`b consoleread`等

## sec02-中断异常机制

ECF=异常控制流

outline：
- 运行环境：
	- 处理器和寄存器
	- 中断机制
	- 存储系统
	- I/O系统
	- 时钟
- 运行机制：系统调用
- 重要设计思想：机制与策略

questions：
- ICS对异常的描述及分类
- 怎样理解“OS是由中断/异常/事件驱动的”这句话
- 中断异常的来源有什么不同？处理方式是一样的吗
- 中断异常机制中，哪些是硬件（体系结构）负责的？哪些是软件（操作系统）负责的？
- 从中断响应（硬件）到中断处理程序（软件）执行结束，计算机系统经过了哪些流程
- 操作系统 初始化与中断 异常有哪些关联
- 怎样理解应用程序是如何与操作系统交互的
- 什么是软件异常？它是如何工作的
- X86 有哪些寄存器？寄存器的作用是什么？
- X86在PentiumII 300之后提供了sysenter、sysexit指令，为什么？与int 0x80/ iret 有什么不同
- 关于基于x86的Linux系统调用实现：
	- 系统调用入口程序 system_call 与中断描述符表是什么关系？与系统调用表是什么关系
	- 系统调用处理结束后，处理器转去执行哪个模块
- 系统调用与C函数调用的区别？系统调用与API的关系？

*操作系统运行环境*：
- CPU：运算器、控制器
- 寄存器：
	- 用户可见寄存器：数据/地址/条件码寄存器
	- 控制和状态寄存器：PC/IR/PSW等

操作系统的需求之一——保护：OS与用户程序隔离

处理器的状态：程序状态字PSW

x86特权级别：内核=R0>R3=用户

RISC-V特权级别：
- Machine：机器模式，权限最高
- Supervisor：监管模式
- User：用户模式，权限最低

CPU状态转换机制：中断/异常/自陷

（P14）

中断机制作用：
- 及时处理设备请求/用户程序服务请求
- 中断引入：支持CPU/设备并行
- 异常引入：表示CPU执行指令时出现的问题

中断异常概念：CPU暂停正在执行的程序，保留现场后自动转去执行相应事件的处理程序，处理完成后返回断点继续执行被打断的程序
- 特点：随机发生、自动处理、可恢复
- 事件：
	- 外中断：I/O、时钟、硬件故障
	- 内中断：系统调用、页错误、保护性异常、断点，etc.

中断/异常工作原理：
- 