
## 84-柱状图最大矩形

给定$1\le n\le 10^5$个非负整数，用来表示柱状图中各个柱子的高度。每个柱子相邻，宽度为1。

求柱状图内的最大矩形。

示例：$a=[2,1,5,6,2,3]$，最大面积为10：

![](https://assets.leetcode.com/uploads/2021/01/04/histogram.jpg)

*思路*：

暴力做法为$O(n^2)$，肯定超时。

考虑对每个位置计算其*两侧最近的小于当前位置值的数组坐标*：
- 左侧符合条件的坐标：$lp=[-1,-1,1,2,1,4]$。
- 右侧符合条件的坐标：$rp=[1,6,4,4,6,6]$。

对每个位置$x$，其当前高度对应的最大矩形大小为：
$$
S[x]=a[x]\cdot (rp[x]-lp[x]-1)
$$
因此：$S=[2,6,10,6,8,3]$，故最大面积是10。

求$lp,rp$可依赖*单调栈*：
- 求$lp$：从左到右扫一遍，维护一个递增栈。每个元素位置$x$的$lp[x]$为插入时的栈顶位置$y$
- 求$rp$：
	- 普通做法：从右到左扫一遍，维护一个递增栈。每个元素位置$x$的$rp[x]$为插入时的栈顶位置$y$
	- *常数优化*：每个被弹出元素$y$的$rp$恰好是当前元素$x$，即$rp[y]=x$。

AC代码：

```cpp
class Solution {
public:
    int largestRectangleArea(vector<int>& heights) {
        int n=heights.size();
        vector<int> stk;
        vector<int> left(n),right(n,n);
        // 为啥right要初始化为全n，因为right不会全体赋值
        for(int i=0;i<n;++i){
            while(stk.size()&&heights[stk.back()]>=heights[i]){
	            right[stk.back()]=i;
	            stk.pop_back();
            } 
            left[i]=stk.size()?stk.back():-1;
            stk.push_back(i);
        }
        long long ans=0;
        for(int i=0;i<n;++i) ans=max(ans,1ll*heights[i]*(right[i]-left[i]-1));
        return ans;
    }
};
```

